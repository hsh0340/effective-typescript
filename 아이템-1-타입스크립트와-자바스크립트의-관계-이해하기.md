타입스크립트와 자바스크립트는 밀접한 관계에 있기 때문에, 서로 어떻게 연관되어있는지 이해하는 것이 중요하다.

# concept 1: 타입스크립트는 자바스크립트의 상위집합이다.

![img](https://github.com/hsh0340/effective-typescript/assets/73820746/ad879698-1128-4258-8596-9cb6ec047de7)

자바스크립트 프로그램에 문법적인 오류가 없다면, 유효한 타입스크립트 프로그램이라고 할 수 있다. 그런데 자바스크립트 프로그램에 어떤 이슈가 존재한다면, 문법 오류가 아니라도 타입 체커에 지적될 가능성이 높다.

예를 들어 다음과 같은 자바스크립트 코드가 있다고 가정해보자.

```jsx
function add(a, b) {
  return a + b;
}

console.log(add(1, "2")); // '12'
```

위 코드는 문법적으로 문제가 없다. 하지만 add 함수는 숫자 두 개를 더하는 용도로 작성되었음에도 불구하고 문자열을 리턴할 수 있다. 위 코드를 타입스크립트로 변환하고 타입체커를 실행해보면,

```tsx
function add(a: number, b: number): number {
  return a + b;
}

console.log(add(1, "2")); // error
```

타입스크립트 타입 체커는 add 함수의 매개변수 a와 b가 number 타입이어야 한다고 명시했기 때문에, 문자열 ‘2’를 전달하면 타입 오류가 발생한다.

그러나 문법의 유효성과 동작의 이슈는 독립적인 문제이다. 타입스크립트는 여전히 작성된 코드를 파싱하고 자바스크립트로 변환 가능하다. (타입 오류가 있는 코드도 컴파일이 가능하다. 이는 아이템 3에서 자세히 다룬다.)

자바스크립트 파일이 .js 확장자를 사용하는 반면, 타입스크립트 파일은 .ts 확장자를 사용한다. 확장자가 다르다고 해서 완전히 다른언어라는 의미가 아니다. 타입스크립트는 자바스크립트의 상위 집합이기 때문에 .js 파일에 있는 코드는 타입스크립트 코드라고 할 수 있다. 이러한 특정은 자바스크립트 코드를 타입스크립트 코드로 마이그레이션 하는데 엄청난 이점이 된다.

모든 타입스크립트 프로그램이 자바스크립트 프로그램은 아니다. 타입스크립트는 타입을 명시하는 추가 문법을 가지기 때문이다. 다음 코드는 유효한 타입스크립트 프로그램이다.



```tsx
function greet(who: string) { // SyntaxError: Unexpected token :
```

`: string` 은 타입스크립트에서 쓰이는 타입구문이다. 타입 구문을 사용하는 순간부터 자바스크립트는 타입스크립트 영역으로 들어가게된다.

# concept 2: 런타임 오류를 막기 위한 타입체커

타입스크립트 컴파일러는 타입스크립트 뿐만 아니라 일반 자바스크립트 프로그램에도 유용하다. 다음은 자바스크립트 코드이다.

```jsx
let city = 'new york city';
console.log(city.toUppercase()); // TypeError: city.toUppercase is not a function
```

타입스크립트로 작성했을 때, 타입 체커는 문제점을 찾아낸다.

```tsx
let city = 'new york city';
console.log(city.toUppercase()); // 'toUppercase' 속성이 'string' 형식에 없습니다.
```

city 변수가 문자열이라는 것을 알려주지 않아도 타입스크립트는 초깃값으로부터 타입을 추론한다.

타입시스템의 목표 중 하나는 런타임에 오류를 발생시킬 코드를 미리 찾아내는 것이다. 타입스크립트가 정적타입언어라는 것도 이 특징 때문이다. 하지만 타입 체커가 모든 오류를 찾아내지는 않는다.

다음과 자바스크립트 코드는 오류가 발생하지는 않지만 의도와 다르게 동작하는 코드이다.

```tsx
const states = [
	{ name: 'Alabama', capital: 'Montgomery' },
	{ name: 'Alaska', capital: 'Juneau' },
	{ name: 'Arizona', capital: 'Phoenix' },
];

for (const state of states) {
	console.log(state.capitol);
}

// undefined
// undefined
// undefined
```

위 코드는 문법적으로 어떠한 오류도 없지만, 루프 내의 `state.capitol`은 의도한 코드가 아닐 것이다. 타입 체커는 타입 구문 없이도 오류를 찾아낸다.

```tsx
for (const state of states) {
	console.log(state.capitol); // 'capitol' 속성이 ... 형식에 없습니다.
}
```

타입 구문을 추가한다면 훨씬 더 많은 오류를 찾아낼 수 있다. 코드의 ‘의도’를 타입 구문을 통해 타입스크립트에게 알려줄 수 있기 때문이다. 명시적으로 state를 선언하여 의도를 분명하게 하는 것이 좋다.

```tsx
interface State {
	name: string;
	capital: string;
}
const state: State[] = [
	{ name: 'Alabama', capitol: 'Montgomery' }, // 'State' 형식에 'capitol' 이 없습니다.
	// ...
```

위 내용을 토대로 벤 다이어그램에 새로운 영역을 추가할 수 있다.

<img width="808" alt="스크린샷 2024-07-02 오후 11 11 27" src="https://github.com/hsh0340/effective-typescript/assets/73820746/a0808ac2-ef29-4920-b5a2-abf79b1e1541">

모든 자바스크립트 코드는 타입스크립트이다. 모든 타입스크립트 코드가 자바스크립트 코드는 아니지만, 타입체커를 통과한 타입스크립트 코드는 자바스크립트 코드가 될 수 있다.

타입스크립트의 타입시스템은 자바스크립트의 런타임 동작을 ‘모델링’한다(타입스크립트가 자바스크립트의 런타임 행동을 추상화 하고, 타입 체커가 이를 기반으로 코드를 분석하여 타입 오류를 발견한다는 뜻). 런타임 체크를 엄격하게 하는 언어를 사용했다면 다음 결과가 당황스러울 것이다.

```tsx
const x = 2 + '3'; // string
const y = '2' + 3; // string
```

위 코드는 다른 언어였다면 런타임 오류가 될 만한 코드이다. 하지만 타입스크립트의 타입체커는 정상으로 인식한다. 자바스크립트 런타임 동작으로 모델링 되기 때문이다.

반대로 정상 동작하는 코드에 오류를 표시하기도 한다.

```tsx
const a = null + 7; // 자바스크립트에서 a는 7이 됨. 타입스크립트에서는 '+' 연산자를 ... 형식에 적용할 수 없습니다
```

자바스크립트의 런타임 동작을 모델링 하는 것은 타입시스템의 기본 원칙이다. 그러나 단순히 모델링하는 것 뿐만 아니라 의도치 않은 이상한 코드가 오류로 이어질 수도 있다. 이처럼 타입스크립트의 도움을 받으면 오류가 적은 코드를 작성할 수 있다.

작성한 코드가 타입 체크를 통과하더라도 런타임에 오류가 발생할 수 있다.

```tsx
const names = ['Alice', 'Bob'];
console.log(names[2].toUpperCase()); // TypeError: Cannot read property 'toUpperCase' of undefined'
```

타입스크립트는 앞의 배열이 범위 내에서 사용될 것이라 가정했지만 실제로는 그렇지 않아 오류가 발생했다.

타입스크립트는 타입체커를 통해 안전성을 보장하려고 한다. 하지만 자바스크립트 동적 특성 때문에 런타임에서 실제 값이 타입스크립트가 예상한 것과 다를 수 있다. 즉 타입 시스템이 정적 타입의 정확성을 보장해 줄 수 없다는 뜻이다. 타입 시스템이 만들어진 가장 큰 목적은 런타임 안정성이 아닌, 런타임 이전에 코드를 잘못 작성하는 것을 방지하는 것이다.

# 요약

- 타입스크립트는 자바스크립트의 상위집합이다. 즉 모든 자바스크립트 프로그램은 이미 타입스크립트 프로그램이다. 반대로 타입스크립트는 별도의 문법을 가지고 있기 때문에 자바스크립트 프로그램이 아닐 수도 있다.
- 타입스크립트는 자바스크립트 런타임 동작을 모델링 하는 타입 시스템을 가지고 있기 때문에 런타임 오류를 발생시키는 코드를 찾아내려고 한다. 하지만 타입체커를 통과하면서도 런타임 오류가 발생할 수 있다. 즉 타입 시스템이 런타임 안정성을 보장할 수 없다.
- 자바스크립트에서는 허용되지만 타입스크립트에서는 문제가 되는 경우도 있다. (위의 `const a = null + 7;` 처럼)